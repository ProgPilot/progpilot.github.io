

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    
    <!-- This is fancy favicon stuff. It uses files generated by https://realfavicongenerator.net but these are stored in another repository.-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="theme-color" content="#ffffff">

    <style>

        @import url("https://fonts.googleapis.com/css?family=Lato:400,400italic,700,700italic");

        .leftpad {
            padding-left: 5px;
        }

        .image-background {
            background-image: url("https://www.progpilot.com/writeups/resources/banner.jpg");
            background-size: cover;
        }

        .header {
            font-family: 'Roboto Mono', monospace;
            color: white;
        }

        .white {
            color: white;
        }

        .whitelink, .whitelink:hover, .whitelink:active, .whitelink:visited {
            color: white;
        }

        .breadcrumb {
            margin-bottom: unset;
            background-color: unset;
            border-radius: unset;
        }

        .breadcrumb-item + .breadcrumb-item::before {
            display: inline-block;
            padding-right: 0.5rem;
            color: white;
            content: ">";
        }

        body {
            font-family: "Lato", sans-serif;
        }

        .navbar a:hover {
            text-decoration: none;
        }

        .p-3 {
            padding: $spacer !important;
        }

    </style>

    
        
    

    <title>XXExternalXX | ProgPilot writeups</title>

    <meta name="description" content="Writeup by the CTF team ProgPilot for XXExternalXX (SharkyCTF 2020)">

    <meta property="og:title" content="XXExternalXX">

<meta property="og:site_name" content="progpilot.com">
<meta property="og:description" content="Writeup by the CTF team ProgPilot for XXExternalXX (SharkyCTF 2020)">
<meta property="og:url" content="https://www.progpilot.com/writeups/sharky2020/xxexternalxx">
<meta property="og:image" content="https://www.progpilot.com/writeups/resources/progpilot.jpg">
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166229733-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166229733-1');
</script>

    

    <style>
    .videoWrapper {
    	position: relative;
    	padding-bottom: 56.25%; /* 16:9 */
    	padding-top: 25px;
    	height: 0;
    }
    .videoWrapper iframe {
    	position: absolute;
    	top: 0;
    	left: 0;
    	width: 100%;
    	height: 100%;
    }

	img {
		max-width: 100%;
		height: auto;
		display: block;
		margin-left: auto;
		margin-right: auto;
		border-style: solid;
		border-width: 1px;
	}
    </style>


</head>
<body>

    <nav class="navbar navbar-expand-lg image-background white">
    <div class="navbar-brand">
        <a class="header whitelink" href="https://www.progpilot.com/writeups/">ProgPilot writeups</a>
    </div>

    <div class="collapse navbar-collapse">
        <div class="navbar-nav mr-auto">
            <ol class="breadcrumb">
                
                
                <li class="breadcrumb-item"><a class="whitelink" href="https://www.progpilot.com/writeups/">Home</a></li>
                
                
                
                <li class="breadcrumb-item"><a class="whitelink" href="../">SharkyCTF 2020</a></li>
                
                
                
                <li class="breadcrumb-item" aria-current="page">XXExternalXX</li>
                
                
            </ol>
        </div>

        
    </div>

</nav>

    <div class="container">

        <div class="p-3"></div>

        

    <h4>Writeup for <b>XXExternalXX</b></h4>
    <p>Category: Web<br>Author: Tom<br>

        

    </p>

    <p>XXExternalXX was a challenge that formed part of the 2020 SharkyCTF competition. We're told that a file named <code>flag.txt</code> has been placed at the server root, and we need to find a way to get at it. We're also given a link to a webpage.</p>
<p>If we go onto the &quot;News&quot; tab of that webpage, we get shown this:</p>
<p><img src="https://cdn.tdpain.net/ctf-writeups/sharky2020/xxexternalxx/newstab.png" alt="newstab"></p>
<p>Look closely at the URL - the query string is <code>?xml=data.xml</code>. This seems like it's a file that's being read from on the webserver. If we request this file directly, we get shown this:</p>
<pre><code class="language-xml">&lt;root&gt;
    &lt;data&gt;
    	17/09/2019 the platform is now online, the fonctionnalities it contains will be audited by one of our society partenairs
    &lt;/data&gt;
&lt;/root&gt;
</code></pre>
<p>If we add some garbage to the query string, like <code>?xml=hfdoluagjsfagdhjkasfdgkjhl</code>, a bunch of errors are spat out of the application.</p>
<p><img src="https://cdn.tdpain.net/ctf-writeups/sharky2020/xxexternalxx/errors.png" alt="errors"></p>
<p>These list off some of the functions that are in use inside of the web app, namely <code>file_get_contents()</code>, <code>DomDocument::loadXML()</code> and <code>simplexml_import_dom()</code>. If we look up the PHP documentation for each function, we can get a better understanding of what each function does and how we might be able to exploit them.</p>
<p>The manual page for <code>file_get_contents</code> is the most interesting (<a href="https://www.php.net/manual/en/function.file-get-contents.php" target="_blank" rel="noopener">found here</a>). As expected, it will return the contents of a file provided as parameters to the function, but it has one interesting example.</p>
<pre><code class="language-php">&lt;?php
$homepage = file_get_contents('http://www.example.com/');
echo $homepage;
?&gt;
</code></pre>
<p>We can see that the function will accept URLs and read from them, so if no input validation is being done on the webserver, we should be able to make the app load our own XML as long as we put it on the internet.</p>
<p>At this point, it becomes a case of writing an XML External Entity injection payload (you can read more about this <a href="https://portswigger.net/web-security/xxe" target="_blank" rel="noopener">here</a>) in order to get the contents of the remote file, <code>/flag.txt</code>. My payload looked like this:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///flag.txt&quot;&gt; ]&gt;&lt;root&gt;&lt;data&gt;&amp;xxe;&lt;/data&gt;&lt;/root&gt;
</code></pre>
<p>It mimics the format of the original XML used by the web app, so the contents of the file will still be shown to us when the page loads.</p>
<p>I uploaded this to my webserver, and set the URL as the query string parameter, which gave me the flag.</p>
<p><img src="https://cdn.tdpain.net/ctf-writeups/sharky2020/xxexternalxx/flag.png" alt="flag"></p>
<p>It's worth noting that you could also have done this with a service like Github Gist or Pastebin in order to get your XML payload on the internet.</p>
<p><img src="https://cdn.tdpain.net/ctf-writeups/sharky2020/xxexternalxx/chall.png" alt="chall"></p>




        <div class="p-3"></div>

        <footer style="font-size: 0.8em;">
    Site last updated on Mon, 13 July @ 10:58AM<br>
    Content copyright &copy; <script>document.write(new Date().getFullYear())</script> ProgPilot
</footer>
<br>

    </div>
</body>
</html>